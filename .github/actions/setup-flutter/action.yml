name: 'Setup Flutter Environment'
description: 'Setup Flutter SDK with caching and dependencies'

inputs:
  flutter-version:
    description: 'Flutter SDK version'
    required: false
    default: '3.16.9'
  
  cache-key:
    description: 'Custom cache key suffix'
    required: false
    default: 'default'
  
  init-project:
    description: 'Initialize Flutter project if not exists'
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: üì¶ Setup Flutter SDK
      uses: subosito/flutter-action@v2
      with:
        flutter-version: ${{ inputs.flutter-version }}
        cache: true
        cache-key: flutter-${{ inputs.cache-key }}-${{ runner.os }}
        cache-path: ${{ runner.tool_cache }}/flutter
    
    - name: üèóÔ∏è Initialize Flutter Project
      if: ${{ inputs.init-project == 'true' }}
      shell: bash
      run: |
        echo "Initializing Flutter project structure..."
        
        # Ge√ßici dizinde temiz Flutter projesi olu≈ütur
        mkdir -p /tmp/flutter_init
        cd /tmp/flutter_init
        flutter create --org com.bazarigo --project-name bazarigo_mobile .
        cd -
        
        # Sadece eksik klas√∂rleri kopyala (varsa olanlara dokunma)
        if [ ! -d "android" ]; then
          echo "Copying Android structure..."
          cp -r /tmp/flutter_init/android .
        fi
        
        if [ ! -d "ios" ]; then
          echo "Copying iOS structure..."
          cp -r /tmp/flutter_init/ios .
        else
          # iOS varsa ama Xcode proje dosyalarƒ± eksikse tamamla
          if [ ! -d "ios/Runner.xcodeproj" ]; then
            echo "Adding missing iOS project files..."
            cp -r /tmp/flutter_init/ios/Runner.xcodeproj ios/
            cp -r /tmp/flutter_init/ios/Runner.xcworkspace ios/
          fi
        fi
        
        if [ ! -d "web" ]; then
          echo "Copying Web structure..."
          cp -r /tmp/flutter_init/web .
        fi
        
        # Lib ve test klas√∂rleri (sadece yoksa)
        if [ ! -d "lib" ]; then
          cp -r /tmp/flutter_init/lib .
        fi
        
        if [ ! -d "test" ]; then
          cp -r /tmp/flutter_init/test .
        fi
        
        echo "‚úÖ Project initialization complete"
    
    - name: üîç Flutter Doctor
      shell: bash
      run: flutter doctor -v
    
    - name: üì• Get Dependencies
      shell: bash
      run: flutter pub get
    
    - name: ‚úÖ Verify Installation
      shell: bash
      run: |
        flutter --version
        dart --version
